<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instalar Bookmarklet - Thermomix Recipe Genius</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f8f9fa;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .bookmarklet-container {
            background: #e8f4fd;
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .bookmarklet-link {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .bookmarklet-link:hover {
            background: #45a049;
            text-decoration: none;
            color: white;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .step {
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
        }

        .step strong {
            color: #2c3e50;
        }

        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .copy-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .copy-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç≥ Thermomix Recipe Genius - Bookmarklet</h1>

        <p style="text-align: center; font-size: 18px; color: #666;">
            Captura recetas de <strong>cualquier p√°gina web</strong> (incluyendo Cookidoo) directamente a tu app Recipe Genius
        </p>

        <div class="instructions">
            <h2>üìã Instrucciones de Instalaci√≥n:</h2>

            <div class="step">
                <strong>Paso 1:</strong> Copia el c√≥digo JavaScript de abajo
            </div>

            <div class="step">
                <strong>Paso 2:</strong> Crea un nuevo marcador en tu navegador
            </div>

            <div class="step">
                <strong>Paso 3:</strong> Pega el c√≥digo como URL del marcador
            </div>

            <div class="step">
                <strong>Paso 4:</strong> Nombra el marcador "üç≥ Recipe Genius Importer"
            </div>
        </div>

        <div class="bookmarklet-container">
            <h2>üìå C√≥digo del Bookmarklet:</h2>
            <p>Copia todo este c√≥digo y √∫salo como URL del marcador:</p>

            <div class="code" id="bookmarklet-code">
                <button class="copy-button" onclick="copyToClipboard()">üìã Copiar</button>
                <br><br>
                <span id="code-content"></span>
            </div>
        </div>

        <div class="instructions">
            <h2>üöÄ C√≥mo usar:</h2>

            <div class="step">
                <strong>Paso 1:</strong> Aseg√∫rate de que Recipe Genius est√© ejecut√°ndose en http://localhost:8080
            </div>

            <div class="step">
                <strong>Paso 2:</strong> Inicia sesi√≥n en Recipe Genius para obtener el token
            </div>

            <div class="step">
                <strong>Paso 3:</strong> Ve a cualquier p√°gina con recetas (Cookidoo, blogs, etc.)
            </div>

            <div class="step">
                <strong>Paso 4:</strong> Haz clic en tu bookmarklet "üç≥ Recipe Genius Importer"
            </div>

            <div class="step">
                <strong>Paso 5:</strong> ¬°La receta se extraer√° autom√°ticamente!
            </div>
        </div>
    </div>

    <script>
        // Bookmarklet code (updated with correct port 8080)
        const bookmarkletCode = `javascript:(function(){'use strict';const API_BASE='http://localhost:3003';const API_ENDPOINT=API_BASE+'/api/import-html';const overlayStyles='#recipe-importer-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:999999;display:flex;justify-content:center;align-items:center;font-family:sans-serif}#recipe-importer-modal{background:white;border-radius:12px;padding:24px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,0.3);position:relative}#recipe-importer-close{position:absolute;top:12px;right:16px;background:none;border:none;font-size:24px;cursor:pointer;color:#666;padding:4px 8px}#recipe-importer-close:hover{color:#000}.recipe-importer-title{color:#2c3e50;margin:0 0 16px 0;font-size:20px;font-weight:600}.recipe-importer-status{padding:12px;border-radius:6px;margin:16px 0;font-weight:500}.status-loading{background:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}.status-success{background:#e8f5e8;color:#2e7d32;border:1px solid #a5d6a7}.status-error{background:#ffebee;color:#c62828;border:1px solid #ffcdd2}.recipe-preview{border:1px solid #e0e0e0;border-radius:8px;padding:16px;margin:16px 0;background:#f9f9f9}.recipe-preview h3{margin:0 0 8px 0;color:#2c3e50;font-size:18px}.recipe-preview p{margin:4px 0;color:#666;font-size:14px}.recipe-importer-buttons{display:flex;gap:12px;margin-top:20px}.btn{padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:14px}.btn-primary{background:#4CAF50;color:white}.btn-secondary{background:#f5f5f5;color:#666;border:1px solid #ddd}.loading-spinner{display:inline-block;width:20px;height:20px;border:3px solid #f3f3f3;border-top:3px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;margin-right:8px}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}';function getAuthToken(){const token=localStorage.getItem('authToken')||localStorage.getItem('token')||localStorage.getItem('jwt')||localStorage.getItem('auth_token');if(!token)throw new Error('No authentication token found. Please login to Recipe Genius first.');return token}function createOverlay(){const existing=document.getElementById('recipe-importer-overlay');if(existing)existing.remove();const style=document.createElement('style');style.textContent=overlayStyles;document.head.appendChild(style);const overlay=document.createElement('div');overlay.id='recipe-importer-overlay';overlay.innerHTML='<div id="recipe-importer-modal"><button id="recipe-importer-close">√ó</button><h2 class="recipe-importer-title">üç≥ Thermomix Recipe Genius</h2><div id="recipe-importer-content"><div class="recipe-importer-status status-loading"><span class="loading-spinner"></span>Analyzing page for recipes...</div></div></div>';document.body.appendChild(overlay);document.getElementById('recipe-importer-close').onclick=()=>overlay.remove();overlay.onclick=e=>{if(e.target===overlay)overlay.remove()};return overlay}function updateContent(html){const content=document.getElementById('recipe-importer-content');if(content)content.innerHTML=html}function showSuccess(data){const recipe=data.recipe;updateContent('<div class="recipe-importer-status status-success">‚úÖ Recipe extracted successfully!</div><div class="recipe-preview"><h3>'+recipe.title+'</h3><p><strong>Ingredients:</strong> '+recipe.ingredients.length+' items</p><p><strong>Instructions:</strong> '+recipe.instructions.length+' steps</p><p><strong>Prep Time:</strong> '+recipe.prepTime+' min</p><p><strong>Servings:</strong> '+recipe.servings+'</p></div><div class="recipe-importer-buttons"><button class="btn btn-primary" onclick="window.open(\\'http://localhost:8080\\',\\'_blank\\')">Open Recipe Genius</button><button class="btn btn-secondary" onclick="document.getElementById(\\'recipe-importer-overlay\\').remove()">Close</button></div>')}function showError(msg){updateContent('<div class="recipe-importer-status status-error">‚ùå '+msg+'</div><div class="recipe-importer-buttons"><button class="btn btn-secondary" onclick="document.getElementById(\\'recipe-importer-overlay\\').remove()">Close</button></div>')}async function extract(){try{createOverlay();const token=getAuthToken();const response=await fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({html:document.documentElement.outerHTML,url:location.href,title:document.title})});const data=await response.json();if(response.ok&&data.success)showSuccess(data);else showError(data.error||'Failed to extract recipe')}catch(e){showError('Could not connect to Recipe Genius. Make sure the app is running.')}}extract()})();`;

        // Display the code
        document.getElementById('code-content').textContent = bookmarkletCode;

        function copyToClipboard() {
            const codeElement = document.getElementById('code-content');
            const textArea = document.createElement('textarea');
            textArea.value = codeElement.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            // Show feedback
            const button = document.querySelector('.copy-button');
            const originalText = button.innerHTML;
            button.innerHTML = '‚úÖ ¬°Copiado!';
            button.style.background = '#28a745';

            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.background = '#007bff';
            }, 2000);
        }
    </script>
</body>
</html>