javascript:void(function(){if(window.tbRunning)return;window.tbRunning=true;function ui(){var d=document.createElement('div');d.id='tb-ui';d.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;border:2px solid #333;padding:25px;z-index:99999;border-radius:12px;font-family:Arial,sans-serif;box-shadow:0 10px 30px rgba(0,0,0,0.3);max-width:400px;text-align:center';d.innerHTML='<h3 style="margin:0 0 15px 0;color:#333;font-size:18px">üçΩÔ∏è TasteBox</h3><p id="tb-msg" style="margin:10px 0;color:#666;line-height:1.4">Conectando con TasteBox...</p><button onclick="document.getElementById(\'tb-ui\').remove();window.tbRunning=false" style="position:absolute;top:8px;right:8px;background:#ff4757;color:white;border:none;padding:5px 8px;border-radius:50%;cursor:pointer;font-size:12px;line-height:1">‚úï</button>';document.body.appendChild(d);}function msg(m){var e=document.getElementById('tb-msg');if(e)e.innerHTML=m;}function openAuthWindow(){var authWin=window.open('http://localhost:8080','tasteboxAuth','width=600,height=700,scrollbars=yes,resizable=yes');msg('Ventana de autenticaci√≥n abierta.<br><br><button onclick="checkAndImport()" style="background:#2ecc71;color:white;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;margin:5px">Reintentar</button>');}function checkAndImport(){msg('Verificando autenticaci√≥n...');fetch('https://localhost:3006/api/auth/verify',{method:'GET',credentials:'include',mode:'cors'}).then(function(r){if(r.ok){return tryImport();}else{throw new Error('No autenticado');}}).catch(function(){msg('Necesitas iniciar sesi√≥n primero.<br><br><button onclick="openAuthWindow()" style="background:#3498db;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-size:14px">üîê Iniciar Sesi√≥n</button><br><small style="color:#666;margin-top:10px;display:block">Inicia sesi√≥n y luego presiona Reintentar</small>');});}function tryImport(){msg('Importando receta...');fetch('https://localhost:3006/api/import-html',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',mode:'cors',body:JSON.stringify({html:document.documentElement.outerHTML,url:location.href,title:document.title})}).then(function(r){if(r.status===401){return checkAndImport();}return r.json();}).then(function(data){if(data&&data.success){msg('‚úÖ ¬°Receta "'+data.recipe.title+'" importada exitosamente!<br><br><button onclick="window.open(\'http://localhost:8080\',\'_blank\')" style="background:#27ae60;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer">Ver en TasteBox</button>');setTimeout(function(){document.getElementById('tb-ui').remove();window.tbRunning=false;},5000);}else if(data&&data.error){msg('‚ùå Error: '+data.error+'<br><br><button onclick="checkAndImport()" style="background:#e74c3c;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer">Reintentar</button>');}}).catch(function(err){msg('‚ùå Error de conexi√≥n: '+err.message+'<br><br><button onclick="checkAndImport()" style="background:#f39c12;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer">Reintentar</button>');});}window.checkAndImport=checkAndImport;window.openAuthWindow=openAuthWindow;ui();checkAndImport();})();